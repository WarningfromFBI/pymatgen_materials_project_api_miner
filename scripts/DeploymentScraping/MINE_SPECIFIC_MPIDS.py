'''
new function which attempts to do a smarter version of executing
the feature minder functions

assumes the function outputs a smart piece of data, a dictionary
'''

from feature_miner_functions import SpecialFeatures
from feature_miner_functions import FINAL_PAPER_FEATURES
from feature_miner_functions import Bond_Order_Features
#important that every feature accepts a picklestruct


import os;
import pickle
import inspect
import matplotlib.pyplot as plt
import numpy as np
import pandas as pd
from sympy import *

import settings
from database_reader_functions import battery_base_reader as bbr
from database_reader_functions import materials_project_reader as mbf;
from feature_miner_functions import ShannonFeatures as BSF;

'''
this is a special function which can read any of the feature miner scripts
and execute all the functions and put it into a dataframe

However, this script mines only specific MPIDS...specifically to address the issue of missing training entries
'''
#this is the shannon feature miner for specific pairing with the pymatgen ionvalence analyzer...Problem is that not all
#compounds have known valences, which makes computation here problematic to say the last...

plt.close("all")

directory = os.path.join(settings.ROOT_DIR,'Materials_Project_Database');
structureDir = os.path.join(settings.basedirectory, 'structure_database');

#THIS BECOMES VERY SLOW WHEN WE USE PYMATGEN's IONIC VALENCE CALCULATOR
dump_name = os.path.join(settings.ROOT_DIR, 'data_dump', 'battery_bond_order_features.csv');
if(not os.path.isfile(dump_name) or os.stat(dump_name).st_size == 0):
    print('starting')
    datframe = pd.DataFrame();
else:
    print('loading existing')
    datframe = pd.read_csv(dump_name, index_col = 0);

testcounter = 0; datframerows = list(); structureMatrix = list();
materialMatrix = list();
errors = 0;
mpid_list = ['mp-9561', 'mvc-14769', 'mvc-34', 'mvc-8638', 'mvc-11600', 'mvc-11458', 'mvc-8434', 'mp-540351', 'mp-32410', 'mp-32487', 'mvc-7049', 'mp-32423', 'mp-705008', 'mvc-15036', 'mvc-3271', 'mvc-9284', 'mp-775543', 'mp-755529', 'mp-9027', 'mvc-11233', 'mvc-1016', 'mvc-1011', 'mvc-560', 'mvc-1868', 'mvc-4930', 'mvc-7256', 'mvc-12198', 'mvc-1311', 'mvc-6929', 'mvc-5592', 'mvc-2220', 'mp-542842', 'mvc-13391', 'mvc-2979', 'mp-765969', 'mp-771427', 'mp-764353', 'mp-774136', 'mp-766980', 'mvc-9788', 'mvc-11572', 'mvc-12012', 'mp-766804', 'mp-769935', 'mp-772257', 'mp-772431', 'mvc-5834', 'mp-772564', 'mvc-12125', 'mvc-11115', 'mp-772662', 'mvc-11657', 'mvc-16353', 'mvc-11541', 'mvc-13696', 'mp-776748', 'mvc-5774', 'mp-34278', 'mp-9750', 'mp-763945', 'mp-775096', 'mvc-3279', 'mp-767277', 'mp-779879', 'mp-780501', 'mp-770576', 'mvc-11093', 'mp-745148', 'mvc-11581', 'mvc-8798', 'mp-779401']
mpid_list = ['mp-10631', 'mp-25214', 'mp-755263', 'mp-25229', 'mp-25262', 'mp-9561', 'mp-5549', 'mp-10033', 'mp-80', 'mp-704672', 'mp-2156', 'mp-10183', 'mp-1907', 'mp-25301', 'mp-1775', 'mvc-14769', 'mvc-1', 'mvc-34', 'mvc-12727', 'mp-510752', 'mp-774719', 'mp-25225', 'mp-775233', 'mp-33009', 'mp-25517', 'mp-714929', 'mp-25524', 'mp-510669', 'mp-25655', 'mp-25620', 'mp-543072', 'mp-25527', 'mp-25577', 'mp-540007', 'mp-510748', 'mp-25633', 'mp-25559', 'mp-510766', 'mp-714876', 'mp-25479', 'mp-25558', 'mp-543096', 'mp-714883', 'mp-714944', 'mp-25581', 'mp-25643', 'mp-25579', 'mp-632694', 'mp-543085', 'mp-25697', 'mp-32518', 'mp-851041', 'mp-543108', 'mp-25610', 'mp-25537', 'mp-772213', 'mp-567597', 'mp-715480', 'mvc-8638', 'mp-543097', 'mp-25669', 'mp-25378', 'mp-504100', 'mp-25436', 'mp-25380', 'mvc-11600', 'mp-25473', 'mp-31750', 'mp-849535', 'mp-25550', 'mp-714969', 'mp-25589', 'mp-635257', 'mp-540008', 'mp-25616', 'mp-32453', 'mvc-11458', 'mp-25651', 'mp-25658', 'mp-25518', 'mvc-8434', 'mp-684096', 'mp-25886', 'mp-25908', 'mp-26074', 'mp-25960', 'mp-26114', 'mp-672945', 'mp-684426', 'mp-584116', 'mp-26210', 'mp-672986', 'mp-26304', 'mp-26342', 'mp-26390', 'mp-757076', 'mp-540258', 'mp-673047', 'mp-26532', 'mp-26542', 'mp-26550', 'mp-26630', 'mp-757192', 'mp-673069', 'mp-753519', 'mp-673078', 'mp-26742', 'mp-673088', 'mp-26796', 'mp-673105', 'mp-673116', 'mp-673017', 'mp-673129', 'mp-26950', 'mp-27018', 'mp-1170', 'mp-31529', 'mp-31532', 'mp-31521', 'mp-704240', 'mp-767450', 'mp-540262', 'mp-705347', 'mp-31597', 'mp-697814', 'mp-585256', 'mp-540491', 'mp-540093', 'mp-31554', 'mp-31550', 'mp-31589', 'mp-540467', 'mp-585416', 'mp-540264', 'mp-31551', 'mp-31617', 'mp-31620', 'mp-540466', 'mp-695952', 'mp-31690', 'mp-540267', 'mp-540291', 'mp-705409', 'mp-31645', 'mp-540430', 'mp-31632', 'mp-31744', 'mp-540326', 'mp-31692', 'mp-31719', 'mp-18906', 'mp-31656', 'mp-31734', 'mp-540211', 'mp-31678', 'mp-764853', 'mp-704231', 'mp-31707', 'mp-31653', 'mp-31745', 'mp-543082', 'mp-31766', 'mp-540341', 'mp-585418', 'mp-31793', 'mp-31810', 'mp-540498', 'mp-31877', 'mp-540197', 'mp-31872', 'mp-540072', 'mp-31829', 'mp-540321', 'mp-540486', 'mp-540440', 'mp-31896', 'mp-704206', 'mp-540342', 'mp-31818', 'mp-690058', 'mp-540388', 'mp-540077', 'mp-777460', 'mp-31942', 'mp-540152', 'mp-697788', 'mp-31935', 'mp-705354', 'mp-32028', 'mp-31927', 'mp-31930', 'mp-540022', 'mp-32003', 'mp-585266', 'mp-704236', 'mp-704227', 'mp-540146', 'mp-763791', 'mp-694554', 'mp-32037', 'mp-697761', 'mp-697794', 'mp-31981', 'mp-704991', 'mp-32010', 'mp-540338', 'mp-706469', 'mp-32085', 'mp-695772', 'mp-32065', 'mp-32059', 'mp-32089', 'mp-32120', 'mp-32086', 'mp-32108', 'mp-32115', 'mp-585184', 'mp-504222', 'mp-540534', 'mp-32117', 'mp-32094', 'mp-25668', 'mp-32054', 'mp-540236', 'mp-32113', 'mp-540025', 'mp-32124', 'mp-504212', 'mp-32365', 'mp-32381', 'mp-32328', 'mp-25604', 'mp-32325', 'mp-540302', 'mp-32331', 'mp-540328', 'mp-32394', 'mp-32401', 'mp-32393', 'mp-32386', 'mp-504166', 'mp-689834', 'mp-32385', 'mp-32367', 'mp-32363', 'mp-540061', 'mp-32455', 'mp-540363', 'mp-540378', 'mp-18835', 'mp-32486', 'mp-540351', 'mp-32416', 'mp-32504', 'mp-32524', 'mp-32477', 'mp-32443', 'mp-540263', 'mp-32519', 'mp-697797', 'mp-32485', 'mp-540427', 'mp-32509', 'mp-32410', 'mp-694629', 'mp-705305', 'mp-32487', 'mp-32457', 'mp-32529', 'mvc-7049', 'mp-510536', 'mp-390', 'mp-25435', 'mp-585435', 'mp-504168', 'mp-672950', 'mp-26172', 'mp-31552', 'mp-32359', 'mp-504251', 'mp-504265', 'mp-32423', 'mp-504341', 'mp-26952', 'mp-504355', 'mp-504357', 'mp-504359', 'mp-504372', 'mp-704226', 'mp-504259', 'mp-540042', 'mp-504406', 'mp-540522', 'mp-705008', 'mp-637219', 'mp-25502', 'mp-25523', 'mp-540010', 'mp-31780', 'mp-31921', 'mp-32442', 'mp-31954', 'mp-32119', 'mp-540069', 'mp-540074', 'mp-540079', 'mp-704210', 'mp-704492', 'mp-540111', 'mp-25664', 'mp-540345', 'mp-25001', 'mp-694547', 'mp-540082', 'mp-540054', 'mp-695808', 'mp-31998', 'mp-540169', 'mp-540301', 'mp-32527', 'mp-540180', 'mp-32466', 'mp-687212', 'mp-540204', 'mp-540416', 'mp-32334', 'mp-540409', 'mp-540249', 'mp-540256', 'mp-540270', 'mvc-15036', 'mp-31564', 'mp-540277', 'mvc-3271', 'mp-697769', 'mp-697806', 'mp-504210', 'mp-540314', 'mp-32433', 'mp-32018', 'mp-689964', 'mp-31874', 'mp-31582', 'mp-32417', 'mp-540419', 'mp-540424', 'mp-540432', 'mp-31572', 'mp-540439', 'mp-540444', 'mp-31669', 'mp-540460', 'mp-32490', 'mp-540463', 'mp-32329', 'mp-540472', 'mp-689981', 'mp-689940', 'mp-31573', 'mp-510751', 'mp-25205', 'mp-755021', 'mp-25472', 'mp-2657', 'mp-779530', 'mp-25544', 'mp-25201', 'mp-775050', 'mp-25569', 'mp-24968', 'mp-25662', 'mp-775220', 'mp-25724', 'mp-557959', 'mp-510764', 'mp-851044', 'mp-571518', 'mp-10184', 'mp-30295', 'mp-850515', 'mp-849237', 'mp-585227', 'mp-31944', 'mp-540142', 'mp-31635', 'mp-540500', 'mp-31610', 'mp-704220', 'mp-689963', 'mp-705467', 'mp-704299', 'mp-25775', 'mp-543104', 'mp-23427', 'mp-634591', 'mp-1156', 'mp-25654', 'mvc-9284', 'mp-633655', 'mp-775539', 'mp-672963', 'mp-672981', 'mp-673020', 'mp-26446', 'mp-684496', 'mp-540379', 'mp-504324', 'mp-540395', 'mp-673117', 'mp-504350', 'mp-673151', 'mp-21021', 'mp-2164', 'mp-684053', 'mp-684083', 'mp-25896', 'mp-25906', 'mp-25946', 'mp-25950', 'mp-25940', 'mp-26150', 'mp-684537', 'mp-26594', 'mp-684502', 'mp-26574', 'mp-684482', 'mp-26286', 'mp-684495', 'mp-26762', 'mp-554631', 'mp-715479', 'mp-25545', 'mp-705201', 'mp-690014', 'mp-31943', 'mp-696012', 'mp-540349', 'mp-31658', 'mp-697815', 'mp-540399', 'mp-32520', 'mp-540323', 'mp-540177', 'mp-504290', 'mp-775246', 'mp-504312', 'mp-540414', 'mp-697819', 'mp-697733', 'mp-782705', 'mp-851050', 'mp-775276', 'mp-704185', 'mp-697734', 'mp-504149', 'mp-19383', 'mp-705019', 'mp-704959', 'mp-705035', 'mp-540050', 'mp-32099', 'mp-585323', 'mp-540274', 'mp-705300', 'mp-31608', 'mp-32056', 'mp-697827', 'mp-32415', 'mp-850470', 'mp-540145', 'mp-540350', 'mp-540336', 'mp-504245', 'mp-540536', 'mp-540528', 'mp-585202', 'mp-705426', 'mp-705395', 'mp-705433', 'mp-705436', 'mp-705637', 'mp-697730', 'mp-705562', 'mp-851287', 'mp-775436', 'mp-754804', 'mp-775543', 'mp-760595', 'mp-766454', 'mp-755529', 'mp-753211', 'mp-754223', 'mp-9027', 'mp-594', 'mp-754672', 'mp-752989', 'mp-756435', 'mp-770474', 'mp-772817', 'mvc-11233', 'mp-766596', 'mp-766877', 'mp-757155', 'mvc-1016', 'mp-757156', 'mvc-1011', 'mp-753860', 'mp-758727', 'mp-757131', 'mvc-560', 'mp-766434', 'mp-761010', 'mp-760579', 'mp-760536', 'mvc-1868', 'mp-768482', 'mp-766118', 'mp-556425', 'mp-27743', 'mvc-4930', 'mp-756573', 'mp-772303', 'mp-560642', 'mp-18687', 'mp-772477', 'mp-767632', 'mp-705024', 'mp-761501', 'mp-775135', 'mp-767346', 'mp-764345', 'mp-850489', 'mp-775192', 'mp-775134', 'mp-771799', 'mp-772685', 'mp-775131', 'mp-767783', 'mp-765982', 'mp-19109', 'mp-540320', 'mp-764338', 'mp-775598', 'mp-767212', 'mp-774406', 'mp-772001', 'mp-775212', 'mp-775968', 'mp-761530', 'mp-767338', 'mvc-7256', 'mp-761557', 'mp-763057', 'mp-775016', 'mp-765838', 'mp-775117', 'mp-763570', 'mp-767446', 'mp-771982', 'mp-761540', 'mp-540391', 'mp-761588', 'mp-765821', 'mp-769840', 'mp-765876', 'mp-765866', 'mp-770909', 'mp-771484', 'mp-761579', 'mvc-12198', 'mp-777108', 'mp-775008', 'mp-778411', 'mp-761589', 'mp-851068', 'mp-765852', 'mp-775472', 'mp-766719', 'mp-775333', 'mp-763352', 'mp-761652', 'mp-775991', 'mp-761807', 'mp-851314', 'mp-775831', 'mp-761701', 'mp-761975', 'mvc-1311', 'mp-761353', 'mp-780043', 'mp-775054', 'mp-775516', 'mp-761041', 'mvc-6929', 'mp-780779', 'mp-763762', 'mp-775128', 'mp-775219', 'mp-774416', 'mp-763673', 'mp-770891', 'mp-763780', 'mp-775437', 'mp-763767', 'mp-850744', 'mp-765783', 'mp-765932', 'mp-765241', 'mp-765952', 'mp-850087', 'mp-556560', 'mp-764440', 'mp-767355', 'mp-863857', 'mp-761802', 'mp-761760', 'mp-771578', 'mp-775510', 'mp-767999', 'mp-772327', 'mp-767351', 'mvc-5592', 'mp-767803', 'mp-767578', 'mp-767481', 'mp-850493', 'mp-761371', 'mp-767239', 'mp-555003', 'mp-767436', 'mp-761345', 'mvc-2220', 'mp-767776', 'mp-767549', 'mp-762512', 'mp-767567', 'mp-763856', 'mp-704123', 'mp-561659', 'mp-851279', 'mp-767454', 'mp-504791', 'mp-762148', 'mp-767085', 'mp-767771', 'mp-767148', 'mp-773366', 'mp-763292', 'mp-763662', 'mp-767435', 'mp-763630', 'mp-849254', 'mp-765939', 'mp-765332', 'mp-765268', 'mp-765234', 'mp-566252', 'mp-569374', 'mp-654373', 'mp-769604', 'mp-565217', 'mp-566264', 'mp-19481', 'mp-25164', 'mp-770015', 'mp-565627', 'mp-771671', 'mp-777435', 'mp-773229', 'mp-849354', 'mp-773140', 'mp-773120', 'mp-771787', 'mp-771048', 'mp-780530', 'mp-765253', 'mp-767122', 'mp-565565', 'mp-565681', 'mp-773432', 'mp-542842', 'mp-766778', 'mp-766158', 'mp-767352', 'mp-556197', 'mp-614777', 'mp-763854', 'mp-767182', 'mp-775041', 'mp-765924', 'mp-772386', 'mp-764402', 'mvc-13391', 'mp-764401', 'mp-767193', 'mp-764252', 'mp-766154', 'mp-559931', 'mp-764415', 'mp-764392', 'mp-765926', 'mp-764243', 'mp-764284', 'mp-764228', 'mp-765773', 'mp-770908', 'mp-764283', 'mp-763860', 'mp-764410', 'mvc-2979', 'mp-764232', 'mp-18953', 'mp-779193', 'mp-775395', 'mp-770251', 'mp-766786', 'mp-763496', 'mp-771625', 'mp-771471', 'mp-567904', 'mp-766781', 'mp-773259', 'mp-773198', 'mp-765500', 'mp-764357', 'mp-765941', 'mp-766396', 'mp-767722', 'mp-762253', 'mp-763596', 'mp-767779', 'mp-765007', 'mp-765273', 'mp-765269', 'mp-764744', 'mp-757495', 'mp-767323', 'mp-765969', 'mp-764959', 'mp-764180', 'mp-765218', 'mp-766790', 'mp-765215', 'mp-765216', 'mp-558797', 'mp-764254', 'mp-765348', 'mp-762227', 'mp-771427', 'mp-767195', 'mp-767020', 'mp-772281', 'mp-764241', 'mp-769678', 'mp-540000', 'mp-761356', 'mp-781081', 'mp-765892', 'mp-764923', 'mp-765777', 'mp-765906', 'mp-765239', 'mp-766792', 'mp-778275', 'mp-850239', 'mp-849352', 'mp-770337', 'mp-765229', 'mp-765708', 'mp-765975', 'mp-764325', 'mp-772359', 'mp-771871', 'mp-767656', 'mp-774257', 'mp-775494', 'mp-764327', 'mp-764353', 'mp-764335', 'mp-765508', 'mp-764379', 'mp-767052', 'mp-774136', 'mp-768262', 'mp-773245', 'mp-849598', 'mp-849543', 'mp-765865', 'mp-767164', 'mp-766980', 'mp-774302', 'mp-775272', 'mp-773269', 'mvc-9788', 'mp-849086', 'mp-761614', 'mp-761933', 'mp-764448', 'mp-767887', 'mp-773919', 'mp-850937', 'mp-764398', 'mp-773300', 'mp-775025', 'mp-765990', 'mp-767830', 'mp-766751', 'mp-771797', 'mp-863848', 'mp-770130', 'mp-765923', 'mp-764432', 'mp-766920', 'mp-765139', 'mp-775168', 'mp-762909', 'mp-767144', 'mp-766932', 'mp-767627', 'mp-753921', 'mp-766870', 'mp-767610', 'mp-774178', 'mp-767208', 'mp-762249', 'mp-765034', 'mp-767187', 'mp-774119', 'mp-772129', 'mp-765911', 'mp-775179', 'mp-775024', 'mp-771856', 'mp-765801', 'mp-772362', 'mvc-11572', 'mp-767172', 'mp-775053', 'mp-764952', 'mvc-12012', 'mp-768357', 'mp-764715', 'mp-849505', 'mp-762239', 'mp-767822', 'mp-767591', 'mp-769438', 'mp-767634', 'mp-767569', 'mp-565784', 'mp-766804', 'mp-765919', 'mp-767815', 'mp-769913', 'mp-770195', 'mp-768099', 'mp-775077', 'mp-775464', 'mp-774419', 'mp-767602', 'mp-851051', 'mp-765140', 'mp-765922', 'mp-778224', 'mp-770762', 'mp-763508', 'mp-776282', 'mp-769642', 'mp-775116', 'mp-769665', 'mp-769432', 'mp-768490', 'mp-768936', 'mp-768950', 'mp-768507', 'mp-769377', 'mp-769935', 'mp-779174', 'mp-782689', 'mp-18989', 'mp-771053', 'mp-761368', 'mp-769544', 'mp-768036', 'mp-763835', 'mp-778217', 'mp-772635', 'mp-772448', 'mp-768093', 'mp-773296', 'mp-774104', 'mp-793783', 'mp-775270', 'mp-782692', 'mp-771938', 'mp-773256', 'mp-773237', 'mp-770617', 'mp-772243', 'mp-771391', 'mp-766913', 'mp-780818', 'mp-764287', 'mp-767197', 'mp-771723', 'mp-773167', 'mp-770045', 'mp-770008', 'mp-773144', 'mp-772257', 'mp-19395', 'mp-770220', 'mp-774461', 'mp-778822', 'mp-767966', 'mp-510421', 'mp-771540', 'mp-774250', 'mp-31941', 'mp-559859', 'mp-770389', 'mp-775468', 'mp-770100', 'mp-770001', 'mp-775450', 'mp-779766', 'mp-19361', 'mp-770163', 'mp-763171', 'mp-770792', 'mp-771190', 'mp-770557', 'mp-770697', 'mp-771742', 'mp-772431', 'mp-773244', 'mvc-5834', 'mp-761447', 'mp-771924', 'mp-765864', 'mp-773280', 'mp-775243', 'mp-773434', 'mp-769598', 'mp-771860', 'mp-775307', 'mp-31982', 'mp-773238', 'mp-778780', 'mp-775017', 'mp-770859', 'mp-773307', 'mp-771184', 'mp-772335', 'mp-778304', 'mp-773294', 'mp-35482', 'mp-771994', 'mp-765912', 'mp-771680', 'mp-777945', 'mp-772450', 'mp-770915', 'mp-769633', 'mp-764085', 'mp-775625', 'mp-773306', 'mp-771632', 'mp-771460', 'mp-773521', 'mp-776985', 'mp-771458', 'mp-771867', 'mp-853198', 'mp-634430', 'mp-772479', 'mp-771791', 'mp-552787', 'mp-771188', 'mp-775463', 'mp-771872', 'mp-764274', 'mp-771789', 'mp-771763', 'mp-771853', 'mp-714961', 'mp-773338', 'mp-771796', 'mp-771199', 'mp-775162', 'mp-771873', 'mp-772058', 'mp-771457', 'mp-771989', 'mp-762679', 'mp-774019', 'mp-772533', 'mp-772564', 'mvc-12125', 'mp-761290', 'mp-762803', 'mp-771737', 'mvc-11115', 'mp-780537', 'mp-772942', 'mp-656852', 'mp-765847', 'mp-772341', 'mp-772662', 'mp-773257', 'mp-770892', 'mp-773170', 'mp-772218', 'mp-775969', 'mp-771582', 'mp-771598', 'mp-771553', 'mp-772446', 'mp-777906', 'mp-773411', 'mp-771533', 'mp-755148', 'mp-771670', 'mp-771800', 'mp-773511', 'mp-776858', 'mp-770056', 'mp-770991', 'mp-775315', 'mp-761512', 'mp-850479', 'mp-6488', 'mp-773058', 'mp-773070', 'mp-780569', 'mp-773061', 'mp-756830', 'mp-773047', 'mp-771844', 'mp-773060', 'mp-763591', 'mvc-11657', 'mp-773305', 'mp-773303', 'mp-769461', 'mp-773263', 'mp-773675', 'mp-25646', 'mp-764115', 'mp-763487', 'mp-771841', 'mp-770394', 'mp-771603', 'mp-763448', 'mp-773279', 'mp-769456', 'mp-715614', 'mp-769488', 'mp-850978', 'mp-765886', 'mp-773614', 'mp-768058', 'mp-773318', 'mp-25661', 'mp-776135', 'mp-850238', 'mp-775288', 'mp-853227', 'mp-765848', 'mp-773999', 'mp-765900', 'mp-762505', 'mp-776354', 'mvc-16353', 'mp-774409', 'mp-773987', 'mp-767120', 'mvc-11541', 'mvc-13696', 'mp-771740', 'mp-776748', 'mp-771798', 'mvc-5774', 'mp-776703', 'mp-772325', 'mp-764630', 'mp-774272', 'mp-767157', 'mp-772442', 'mp-771564', 'mp-766403', 'mp-25305', 'mp-774710', 'mp-558139', 'mp-849992', 'mp-776310', 'mp-772125', 'mp-767469', 'mp-754767', 'mp-775891', 'mp-767158', 'mp-771431', 'mp-32686', 'mp-776667', 'mp-761712', 'mp-764646', 'mp-765823', 'mp-767833', 'mp-850500', 'mp-766904', 'mp-34134', 'mp-775137', 'mp-773181', 'mp-764449', 'mp-775293', 'mp-773677', 'mp-18949', 'mp-763518', 'mp-755667', 'mp-769218', 'mp-771758', 'mp-773383', 'mp-763248', 'mp-772482', 'mp-34278', 'mp-772598', 'mp-777021', 'mp-775644', 'mp-776755', 'mp-772458', 'mp-773602', 'mp-850365', 'mp-770865', 'mp-771461', 'mp-771811', 'mp-851003', 'mp-773946', 'mp-775006', 'mp-770898', 'mp-656884', 'mp-776082', 'mp-9750', 'mp-761042', 'mp-767526', 'mp-776759', 'mp-778073', 'mp-776190', 'mp-756587', 'mp-776184', 'mp-761587', 'mp-554701', 'mp-849596', 'mp-17242', 'mp-556822', 'mp-767534', 'mp-777235', 'mp-775967', 'mp-774537', 'mp-774289', 'mp-771388', 'mp-778021', 'mp-776485', 'mp-774390', 'mp-780598', 'mp-776680', 'mp-765763', 'mp-771749', 'mp-771095', 'mp-778074', 'mp-778517', 'mp-777531', 'mp-774420', 'mp-778714', 'mp-772423', 'mp-776812', 'mp-778921', 'mp-770554', 'mp-777025', 'mp-779962', 'mp-770558', 'mp-770531', 'mp-770538', 'mp-767483', 'mp-782703', 'mp-763945', 'mp-778750', 'mp-781965', 'mp-779365', 'mp-775790', 'mp-32469', 'mp-772375', 'mp-776725', 'mp-777230', 'mp-776864', 'mp-760109', 'mp-19457', 'mp-771261', 'mp-776807', 'mp-772374', 'mp-851036', 'mp-782664', 'mp-25631', 'mp-775096', 'mp-779256', 'mp-31698', 'mp-776915', 'mp-765782', 'mp-771572', 'mp-776923', 'mp-778705', 'mp-765931', 'mp-772328', 'mp-768512', 'mp-776878', 'mp-763267', 'mp-778699', 'mp-764020', 'mp-775033', 'mp-776879', 'mp-777082', 'mp-777183', 'mp-863878', 'mp-763973', 'mvc-3279', 'mp-773464', 'mp-772336', 'mp-770751', 'mp-554954', 'mp-774191', 'mp-778446', 'mp-768451', 'mp-771265', 'mp-771368', 'mp-781010', 'mp-778349', 'mp-771299', 'mp-766789', 'mp-777692', 'mp-774387', 'mp-850473', 'mp-769844', 'mp-775996', 'mp-765936', 'mp-767277', 'mp-765921', 'mp-775200', 'mp-763927', 'mp-779879', 'mp-35925', 'mp-770187', 'mp-540494', 'mp-775438', 'mp-771363', 'mp-776060', 'mp-763169', 'mp-25526', 'mp-540091', 'mp-774413', 'mp-777967', 'mp-764471', 'mp-779212', 'mp-764086', 'mp-778865', 'mp-777433', 'mp-764172', 'mp-766617', 'mp-777317', 'mp-771910', 'mp-765672', 'mp-760060', 'mp-763134', 'mp-773753', 'mp-780501', 'mp-771931', 'mp-778552', 'mp-777606', 'mp-767344', 'mp-775201', 'mp-761636', 'mp-769849', 'mp-25595', 'mp-770576', 'mvc-11093', 'mp-779357', 'mp-780886', 'mp-769958', 'mp-773365', 'mp-759223', 'mp-561057', 'mp-554799', 'mp-771556', 'mp-505436', 'mp-779347', 'mp-561012', 'mp-763541', 'mp-540485', 'mp-763482', 'mp-773374', 'mp-776750', 'mp-779406', 'mp-771905', 'mp-633897', 'mp-771479', 'mp-771657', 'mp-771584', 'mp-762900', 'mp-775296', 'mp-779978', 'mp-778922', 'mp-745148', 'mp-851257', 'mp-541668', 'mp-540496', 'mp-761932', 'mp-773240', 'mp-25519', 'mp-757045', 'mp-850220', 'mp-774992', 'mp-849700', 'mp-779909', 'mp-761288', 'mp-764130', 'mp-770696', 'mp-764049', 'mp-774025', 'mp-764012', 'mp-779309', 'mvc-11581', 'mvc-8798', 'mp-763661', 'mp-775181', 'mp-779199', 'mp-849565', 'mp-782708', 'mp-779943', 'mp-779401', 'mp-777026', 'mp-774043', 'mp-774072', 'mp-714904', 'mp-769584', 'mp-778252', 'mp-851127', 'mp-780521', 'mp-31866', 'mp-771678', 'mp-774344', 'mp-765772', 'mp-774029', 'mp-850874', 'mp-851282', 'mp-565935', 'mp-764159', 'mp-772363', 'mp-764296', 'mp-764329']

for mpid in mpid_list:

    print('file no. ' + str(testcounter))
    testcounter+=1;
    #if(testcounter>2): break;

    try:

        [matdata, s] = mbf.readCompound(mpid+'.txt')
        ID = matdata['pretty_formula'] + ', ' + matdata['material_id'];
        #print(ID)
        if(ID in datframe.index):
            print('ALREADY PROCESSED')
            continue;
        structureClassUnLith = pickle.load(open(structureDir + '\\' + mpid + '.p', 'rb'));
        picklestruct = structureClassUnLith
        ##================STRUCTURAL FEATURE EXTRACTION===============================#

        all_functions = inspect.getmembers(Bond_Order_Features, inspect.isfunction)
        for key, value in all_functions:
            if str(inspect.signature(value)) == "(picklestruct)":
                data = value(picklestruct)
                #print(data)
                #iterate through keys of data
                for key in data:
                    datframe.set_value(ID, key, data[key])
        #print(datframe)
        if(testcounter%1000 == 0):
            print(datframe.shape);
            print('errors: '+str(errors))
    except Exception as e:
        #dump the file so we don't lose any progress we made during the mining process
        datframe.to_csv(dump_name)

        errors+=1;
        print(e)

print('ERRORS ENCOUNTERED: '+str(errors))
datframe.to_csv(dump_name)